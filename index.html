<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Blog</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .post-actions-small {
            display: flex;
            gap: 10px;
        }
        .btn-small {
            padding: 5px 10px;
            font-size: 14px;
            display: inline-block;
            text-decoration: none;
            border-radius: 3px;
            transition: background-color 0.3s;
            cursor: pointer;
            border: none;
        }
        .btn-edit-small {
            background-color: #28a745;
            color: white;
        }
        .btn-edit-small:hover {
            background-color: #218838;
        }
        .btn-delete-small {
            background-color: #dc3545;
            color: white;
        }
        .btn-delete-small:hover {
            background-color: #c82333;
        }
        #addPostForm, #editPostForm {
            display: none;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        .close-modal:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <header class="banner">
        <div class="navbar">
            <div class="logo">My Blog</div>
            <nav>
                <ul>
                    <li><a href="#" onclick="showHome()">Home</a></li>
                    <li><a href="#" onclick="showAddPost()">Add Post</a></li>
                </ul>
            </nav>
        </div>
        <div class="banner-text">
            <h1>Welcome to My Blog</h1>
            <p>Insights and stories from around the world</p>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Home Page -->
            <div id="homePage">
                <div id="successMessage" style="display: none;" class="success-message"></div>
                <div id="postsContainer"></div>
            </div>

            <!-- Add Post Form -->
            <div id="addPostForm">
                <form onsubmit="addPost(event)">
                    <div class="form-group">
                        <label for="title">Title:</label>
                        <input type="text" id="title" name="title" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="content">Content:</label>
                        <p style="font-size: 0.9em; color: #666; margin-bottom: 5px;">
                            <strong>Formatting tips:</strong><br>
                            ‚Ä¢ **text** for <strong>bold</strong><br>
                            ‚Ä¢ *text* for <em>italic</em><br>
                            ‚Ä¢ # Header 1, ## Header 2, ### Header 3<br>
                            ‚Ä¢ --- for horizontal line
                        </p>
                        <textarea id="content" name="content" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                        <input type="submit" value="Add Post" class="btn">
                        <button type="button" class="btn" style="background-color: #6c757d; margin-left: 10px;" onclick="showHome()">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Edit Post Modal -->
            <div id="editModal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeEditModal()">&times;</span>
                    <h2>Edit Post</h2>
                    <form onsubmit="updatePost(event)">
                        <input type="hidden" id="editPostId">
                        <div class="form-group">
                            <label for="editTitle">Title:</label>
                            <input type="text" id="editTitle" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editContent">Content:</label>
                            <p style="font-size: 0.9em; color: #666; margin-bottom: 5px;">
                                <strong>Formatting tips:</strong> **bold**, *italic*, ### headers, --- for line
                            </p>
                            <textarea id="editContent" class="form-control" required></textarea>
                        </div>
                        <div class="form-group">
                            <input type="submit" value="Update Post" class="btn">
                            <button type="button" class="btn" style="background-color: #6c757d; margin-left: 10px;" onclick="closeEditModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- View Post Modal -->
            <div id="viewModal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeViewModal()">&times;</span>
                    <div id="viewPostContent"></div>
                    <div style="margin-top: 20px;">
                        <button class="btn" style="background-color: #6c757d;" onclick="closeViewModal()">‚Üê Back</button>
                        <button class="btn btn-edit-small" onclick="editFromView()" style="margin-left: 10px;">‚úèÔ∏è Edit</button>
                        <button class="btn btn-delete-small" onclick="deleteFromView()" style="margin-left: 10px;">üóëÔ∏è Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 My Blog. All rights reserved.</p>
    </footer>

    <script>
        // Storage for posts
        let posts = JSON.parse(localStorage.getItem('blogPosts')) || [];
        let nextId = parseInt(localStorage.getItem('nextId')) || 1;
        let currentViewPostId = null;

        // Format content with Markdown-style formatting
        function formatContent(content) {
            // Escape HTML
            content = content.replace(/&/g, '&amp;')
                           .replace(/</g, '&lt;')
                           .replace(/>/g, '&gt;')
                           .replace(/"/g, '&quot;')
                           .replace(/'/g, '&#039;');
            
            // Headers
            content = content.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            content = content.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            content = content.replace(/^# (.+)$/gm, '<h1>$1</h1>');
            
            // Horizontal rules
            content = content.replace(/^---+$/gm, '<hr>');
            content = content.replace(/^\*\*\*+$/gm, '<hr>');
            
            // Bold
            content = content.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            content = content.replace(/\*(.+?)\*/g, '<em>$1</em>');
            
            // Line breaks
            content = content.replace(/\n/g, '<br>');
            
            return content;
        }

        // Create excerpt
        function createExcerpt(content, length = 200) {
            const plain = content.replace(/<[^>]*>/g, '');
            if (plain.length > length) {
                return plain.substring(0, length) + '...';
            }
            return plain;
        }

        // Display posts
        function displayPosts() {
            const container = document.getElementById('postsContainer');
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="post">
                        <h2>No posts yet</h2>
                        <p>Be the first to create a post!</p>
                        <button class="btn" onclick="showAddPost()">Add Your First Post</button>
                    </div>
                `;
                return;
            }

            // Sort by newest first
            const sortedPosts = [...posts].reverse();
            
            container.innerHTML = sortedPosts.map(post => `
                <div class="post">
                    <h2>${escapeHtml(post.title)}</h2>
                    <p>${escapeHtml(createExcerpt(post.content, 200))}</p>
                    <div class="post-meta">
                        <a class="read-more" href="#" onclick="viewPost(${post.id}); return false;">Read more</a>
                        <div class="post-actions-small">
                            <button class="btn-small btn-edit-small" onclick="editPost(${post.id})">‚úèÔ∏è Edit</button>
                            <button class="btn-small btn-delete-small" onclick="deletePost(${post.id})">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Show home page
        function showHome() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('addPostForm').style.display = 'none';
            displayPosts();
        }

        // Show add post form
        function showAddPost() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('addPostForm').style.display = 'block';
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
        }

        // Add post
        function addPost(event) {
            event.preventDefault();
            
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            
            posts.push({
                id: nextId++,
                title: title,
                content: content,
                created_at: new Date().toISOString()
            });
            
            localStorage.setItem('blogPosts', JSON.stringify(posts));
            localStorage.setItem('nextId', nextId.toString());
            
            showHome();
            showSuccessMessage('Post added successfully!');
        }

        // View post
        function viewPost(id) {
            const post = posts.find(p => p.id === id);
            if (!post) return;
            
            currentViewPostId = id;
            document.getElementById('viewPostContent').innerHTML = `
                <h2>${escapeHtml(post.title)}</h2>
                <div>${formatContent(post.content)}</div>
            `;
            document.getElementById('viewModal').style.display = 'block';
        }

        // Edit post
        function editPost(id) {
            const post = posts.find(p => p.id === id);
            if (!post) return;
            
            document.getElementById('editPostId').value = id;
            document.getElementById('editTitle').value = post.title;
            document.getElementById('editContent').value = post.content;
            document.getElementById('editModal').style.display = 'block';
        }

        // Edit from view modal
        function editFromView() {
            closeViewModal();
            editPost(currentViewPostId);
        }

        // Update post
        function updatePost(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editPostId').value);
            const title = document.getElementById('editTitle').value;
            const content = document.getElementById('editContent').value;
            
            const postIndex = posts.findIndex(p => p.id === id);
            if (postIndex !== -1) {
                posts[postIndex].title = title;
                posts[postIndex].content = content;
                localStorage.setItem('blogPosts', JSON.stringify(posts));
                
                closeEditModal();
                displayPosts();
                showSuccessMessage('Post updated successfully!');
            }
        }

        // Delete post
        function deletePost(id) {
            if (!confirm('Are you sure you want to delete this post?')) return;
            
            posts = posts.filter(p => p.id !== id);
            localStorage.setItem('blogPosts', JSON.stringify(posts));
            
            displayPosts();
            showSuccessMessage('Post deleted successfully!');
        }

        // Delete from view modal
        function deleteFromView() {
            closeViewModal();
            deletePost(currentViewPostId);
        }

        // Close modals
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function closeViewModal() {
            document.getElementById('viewModal').style.display = 'none';
            currentViewPostId = null;
        }

        // Show success message
        function showSuccessMessage(message) {
            const msgElement = document.getElementById('successMessage');
            msgElement.textContent = message;
            msgElement.style.display = 'block';
            setTimeout(() => {
                msgElement.style.display = 'none';
            }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Initialize
        displayPosts();
    </script>
</body>
</html>